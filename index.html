<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ü‡∏ô üíï</title>
    <!-- CSS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ -->
    <style>
      /* ... ‡πÉ‡∏™‡πà CSS ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤ ... */
      /* (‡∏Ç‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ) */
    </style>
</head>
<body>
    <!-- Floating hearts ‡πÅ‡∏•‡∏∞ container ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏° -->
    <!-- ... (HTML body ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö) ... -->

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

    <script>
    // 1. ‡πÉ‡∏™‡πà config ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const firebaseConfig = {
      apiKey: "AIzaSyC8HyR2QaZpwSOvI5Pq9_agm1vvZbzqT5c",
      authDomain: "photo-92307.firebaseapp.com",
      projectId: "photo-92307",
      storageBucket: "photo-92307.firebasestorage.app",
      messagingSenderId: "309208647555",
      appId: "1:309208647555:web:25f27ecd18679f457318b6"
    };
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
    const db = firebase.firestore();

    // 2. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ ‡πÅ‡∏•‡∏∞ DOM refs
    let photos = [];
    const gallery = document.getElementById('gallery');
    const fileInput = document.getElementById('fileInput');
    const uploadArea = document.querySelector('.upload-area');
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const closeModal = document.querySelector('.close');

    // 3. ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å Firestore
    function loadPhotosFromFirebase() {
      db.collection("photos").orderBy("timestamp", "desc").get().then(snapshot => {
        photos = [];
        snapshot.forEach(doc => {
          photos.push({ ...doc.data(), id: doc.id });
        });
        renderGallery();
        updateStats();
      });
    }

    // 4. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ
    fileInput.addEventListener('change', handleFiles);
    uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      handleFiles({ target: { files: e.dataTransfer.files } });
    });

    function handleFiles(e) {
      const files = Array.from(e.target.files);
      files.forEach(file => {
        if (file.type.startsWith('image/')) {
          const fileName = Date.now() + '_' + file.name;
          const storageRef = storage.ref('photos/' + fileName);
          storageRef.put(file).then(snapshot => snapshot.ref.getDownloadURL())
            .then(url => {
              // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å metadata ‡∏•‡∏á Firestore
              return db.collection('photos').add({
                name: file.name,
                url: url,
                date: new Date().toLocaleDateString('th-TH'),
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
              });
            }).then(() => {
              loadPhotosFromFirebase();
            });
        }
      });
    }

    // 5. ‡∏•‡∏ö‡∏£‡∏π‡∏õ (Storage + Firestore)
    window.deletePhoto = function(photoId, url) {
      if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°? ü•∫')) {
        // ‡∏•‡∏ö‡πÉ‡∏ô Firestore
        db.collection('photos').doc(photoId).delete().then(() => {
          // ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô Storage
          const storageRef = storage.refFromURL(url);
          storageRef.delete().then(() => {
            loadPhotosFromFirebase();
          });
        });
      }
    }

    // 6. Render Gallery
    function renderGallery() {
      if (photos.length === 0) {
        gallery.innerHTML = `
          <div class="empty-state">
            <div style="font-size: 4em; margin-bottom: 20px;">üå∏</div>
            <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h3>
            <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏´‡∏ß‡∏≤‡∏ô‡πÜ ‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</p>
          </div>
        `;
        return;
      }
      gallery.innerHTML = photos.map(photo => `
        <div class="photo-card">
          <div class="photo-overlay">üíï</div>
          <img src="${photo.url}" alt="${photo.name}" onclick="openModal('${photo.url}')">
          <div class="photo-info">
            <div class="photo-date">${photo.date || ''}</div>
            <button class="delete-btn" onclick="deletePhoto('${photo.id}','${photo.url}')">
              üóëÔ∏è ‡∏•‡∏ö
            </button>
          </div>
        </div>
      `).join('');
    }

    // 7. Modal ‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà
    window.openModal = function(src) {
      modal.style.display = 'block';
      modalImg.src = src;
    }
    closeModal.addEventListener('click', () => { modal.style.display = 'none'; });
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });

    // 8. Stats (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ)
    function updateStats() {
      document.getElementById('photoCount').textContent = photos.length;
    }

    // 9. Days together
    function calcDaysTogether() {
      const startDate = new Date(2024, 1, 14); // 14 ‡∏Å.‡∏û. 2024
      const now = new Date();
      const diffTime = now - startDate;
      return Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
    }
    function updateDaysTogether() {
      document.getElementById('daysTogether').textContent = calcDaysTogether();
    }
    updateDaysTogether();
    setInterval(updateDaysTogether, 3600000);

    // 10. Sparkle & Compliment ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
    function createSparkle() { /* ... */ }
    setInterval(createSparkle, 3000);
    const compliments = [
      "‡∏™‡∏ß‡∏¢‡∏°‡∏≤‡∏Å‡πÄ‡∏•‡∏¢! üòç",
      "‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏à‡∏±‡∏á! üíï",
      "‡∏´‡∏•‡∏á‡∏£‡∏±‡∏Å‡πÅ‡∏•‡πâ‡∏ß! üòä",
      "‡∏™‡∏ß‡∏¢‡πÄ‡∏ß‡∏≠‡∏£‡πå! ‚ú®",
      "‡πÅ‡∏ü‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å! üíñ"
    ];
    function showRandomCompliment() { /* ... */ }
    setInterval(showRandomCompliment, 30000);
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
    `;
    document.head.appendChild(style);

    // 11. ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    loadPhotosFromFirebase();
    </script>
</body>
</html>
